{{> header}}


<div class="container">
  <div class="row">
    <div class="col-md-9">

      <div id="crd_img" class="row">
        <!--Carousel Wrapper-->
                <div id="carousel-example-1z" class="carousel slide carousel-fade" data-ride="carousel">
                    <!--Indicators-->
                    <ol class="carousel-indicators">
                        <li data-target="#carousel-example-1z" data-slide-to="0" class="active"></li>
                        <li data-target="#carousel-example-1z" data-slide-to="1"></li>
                        <li data-target="#carousel-example-1z" data-slide-to="2"></li>
                    </ol>
                    <!--/.Indicators-->
                    <!--Slides-->
                    <div class="carousel-inner" role="listbox">
                        <!--First slide-->
                        <div class="carousel-item active">
                            <img class="d-block w-100" style="height:400px;" src="../../public/images/dest_sri.jpg" alt="First slide">
                        </div>
                        <!--/First slide-->
                        {{#each images}}
                        <!--Second slide-->
                        <div class="carousel-item">
                            <img class="d-block w-100" style="height:400px;" src="../../{{this.img_url}}" alt="Second slide">
                        </div>
                        <!--/Second slide-->
                        {{/each}}
                    </div>
                    <!--/.Slides-->
                    <!--Controls-->
                    <a class="carousel-control-prev" href="#carousel-example-1z" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carousel-example-1z" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                    <!--/.Controls-->
                </div>
                <!--/.Carousel Wrapper-->
      </div>

      <div id="crd_body" class="row">
                  <!--Panel-->
          <div  class="card w-100">
              <div class="card-body transparent">

                  <h3 class="card-title">{{this.b_name1}} {{this.m_name1}}</h3>
                  {{#each v_details}}
                  <h3>Owner</h3>
                  <h5 class="primary-text">{{this.owner}}</h5>
                  <hr>
                  <h3>Description</h3>
                  <p class="card-text primary-text">{{this.description}}</p>
                  <hr>
                  <strong class="p-3 mb-2 bg-success text-white">RS {{this.rate}} per 1 KM</strong>

                  <hr>
                  <!-- Button trigger modal -->
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal123">
                    Show Events
                  </button>


                  {{/each}}
              </div>
          </div>
          <!--/.Panel-->
      </div>
    </div>


    <div class="col-md-3">
      <p class="font-weight-normal">Related Vehicles.</p>
      <div class="list-group">
        {{#each models}}
        <a href="/vehicle/display_relativevcls?m_id={{this.id}}&b_id={{this.brand_id}}" class="list-group-item waves-effect">{{this.m_name}}</a>
        {{/each}}

      </div>
    </div>
  </div>

  <!-- <div class="row">
    <div class="container text-center my-3">
        <h3>Related vehicles</h3>
        <div id="recipeCarousel" class="carousel slide w-100" data-ride="carousel">
            <div class="carousel-inner w-100" role="listbox">
                <div class="carousel-item row active">
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(7).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(9).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(17).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(27).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="carousel-item row">
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(13).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(12).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(7).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 float-left">
                      <div class="view zoom">
                        <img src="https://mdbootstrap.com/img/Photos/Horizontal/People/6-col/img%20(7).jpg" class="img-fluid " alt="">
                        <div class="mask flex-center">
                            <p class="white-text">Zoom effect</p>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
            <a class="carousel-control-prev" href="#recipeCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#recipeCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>


    </div>
  </div> -->




</div>



<!-- Modal -->
<div class="modal fade" id="exampleModal123" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Calander</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
            <div id='top'>

              <div style='float:left'>
                Timezone:
                <select id='timezone-selector'>
                  <option value='' selected>none</option>
                  <option value='local'>local</option>
                  <option value='UTC'>UTC</option>
                </select>
              </div>

              <div style='float:right'>
                <span id='loading'>loading...</span>

              </div>

              <div style='clear:both'></div>
            </div>
              <div id="calendar"></div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <a href="#upper12" id="save_btn" class="btn btn-primary">Save changes</a>

          </div>
      </div>
  </div>
</div>

<!--end of modal calander-->

<div class="container">
  <div class="upper" id="upper12">
    <table border="1">
  <tr>
  <td valign="top">
  <div id="map" style="width: 600px; height: 500px;"></div>
  </td>
  <td>
  <div id="side_bar" style="width:200px; height: 600px; overflow: auto"></div>
  </td>
  </tr>
  </table>

  <input type="text" id="distance" value="3" size="2" hidden>
  <input type="text" id="from" value="denver" class="form-control" />to
  <input type="text" id="to" value="oklahoma city, OK" class="form-control"/>
  <input type="submit" class="btn btn-primary" onclick="route()" />
  <br>

  <input type="text" id="type" hidden value="natural_feature" />

  <input type="text" id="keyword" hidden value="" />

  <input type="text" id="name" value=""  hidden/>
  <div id="towns"></div>
  </div>
</div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<div class="container-fluid">
  {{> footer}}

</div>

<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>

 <script type="text/javascript" src="/javascripts/jquery.smartWizard.min.js"></script>
 <!-- <script type="text/javascript">
   S(document).ready(function(){
     $('#save_btn').click(function(){
       $('#upper12').css("display","block");
     });
   });
 </script> -->
<script type="text/javascript">
  $(document).ready(function(){
    (function($) {
    "use strict";

    // manual carousel controls
    $('.next').click(function(){ $('.carousel').carousel('next');return false; });
    $('.prev').click(function(){ $('.carousel').carousel('prev');return false; });

})(jQuery);
  });
</script>
<script type="text/javascript">
$(document).ready(function() {
  $('#myCarousel').carousel({
    interval: 10000
})
});
</script>
<script>

$(document).ready(function() {
 var calendar = $('#calendar').fullCalendar({
  editable:true,
  header:{
   left:'prev,next today',
   center:'title',
   right:'month,agendaWeek,agendaDay'
  },
  navLinks: true,
  loading: function(bool) {
      $('#loading').toggle(bool);
  },
  eventRender: function(event, el) {
  // render the timezone offset below the event title
  if (event.start.hasZone()) {
    el.find('.fc-title').after(
      $('<div class="tzo"/>').text(event.start.format('Z'))
    );
  }
},
  events:'/vehicle/book?vehi_id={{id}}',

  selectable:true,
  selectHelper:true,
  select: function(start, end, allDay)
  {
   var title = prompt("Enter Event Title");
   if(title)
   {
    var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
    var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
    var vehi_id={{id}};
      $.ajax({
        url:'/vehicle/insert_booking',
        type:'POST',
        data:{title:title,start:start,end:end,vehi_id:vehi_id},
        success:function(data){
          calendar.fullCalendar('refetchEvents');
          alert("added successfully");
        }
      });
   }
  },
  editable:true,
  eventResize:function(event)
  {
   var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
   var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
   var title = event.title;
   var id = event.id;
    $.ajax({
      url:'/vehicle/update_booking',
      type:'POST',
      data:{title:title,start:start,end:end,id:id},
      success:function(data){
        // calendar.fullCalendar('refetchEvents');
        alert("Update successfully");
      }
    })
  },

  eventDrop:function(event)
  {
   var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
   var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
   var title = event.title;
   var id = event.id;
   $.ajax({
     url:"/vehicle/update_booking",
     type:"POST",
     data:{title:title, start:start, end:end, id:id},
     success:function(data)
     {
      // calendar.fullCalendar('refetchEvents');
      alert("Event Updated");
     }
    });
  },

  eventClick:function(event)
  {
   if(confirm("Are you sure you want to remove it?"))
   {
    var id = event.id;
   	$.ajax({
       url:"/vehicle/delete_booking",
       type:"POST",
       data:{id:id},
       success:function(data)
       {
         calendar.fullCalendar('refetchEvents');
         alert("Event Removed");
       }
   	});
   }
  },

 });

 // load the list of available timezones, build the <select> options
 $.getJSON('https://fullcalendar.io/demo-timezones.json', function(timezones) {
   $.each(timezones, function(i, timezone) {
     if (timezone != 'UTC') { // UTC is already in the list
       $('#timezone-selector').append(
         $("<option/>").text(timezone).attr('value', timezone)
       );
     }
   });
 });

 // when the timezone selector changes, dynamically change the calendar option
 $('#timezone-selector').on('change', function() {
   $('#calendar').fullCalendar('option', 'timezone', this.value || false);
 });
});



</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvJqq1kg_ebCZKE4V9jqYHHC1pfrP4kA0&libraries=places"></script>
<script src="https://cdn.rawgit.com/googlemaps/v3-utility-library/master/routeboxer/src/RouteBoxer.js" type="text/javascript"></script>
<script type="text/javascript">
var map = null;
var boxpolys = null;
var directions = null;
var routeBoxer = null;
var distance = null; // km
var service = null;
var gmarkers = [];
var boxes = null;
var infowindow = new google.maps.InfoWindow();

function initialize() {
// Default the map view to the continental U.S.
var mapOptions = {
  center: new google.maps.LatLng(40, -80.5),
  mapTypeId: google.maps.MapTypeId.ROADMAP,
  zoom: 8
};

map = new google.maps.Map(document.getElementById("map"), mapOptions);
service = new google.maps.places.PlacesService(map);

routeBoxer = new RouteBoxer();

directionService = new google.maps.DirectionsService();
directionsRenderer = new google.maps.DirectionsRenderer({
  map: map
});

// If there are any parameters at eh end of the URL, they will be in  location.search
// looking something like  "?marker=3"

// skip the first character, we are not interested in the "?"
var query = location.search.substring(1);

// split the rest at each "&" character to give a list of  "argname=value"  pairs
var pairs = query.split("&");
for (var i = 0; i < pairs.length; i++) {
  // break each pair at the first "=" to obtain the argname and value
  var pos = pairs[i].indexOf("=");
  var argname = pairs[i].substring(0, pos).toLowerCase();
  var value = pairs[i].substring(pos + 1).toLowerCase();

  // process each possible argname  -  use unescape() if theres any chance of spaces
  if (argname == "to") {
    document.getElementById('to').value = unescape(value);
  }
  if (argname == "from") {
    document.getElementById('from').value = unescape(value);
  }
  if (argname == "dist") {
    document.getElementById('distance').value = parseFloat(value);
  }
  if (argname == "type") {
    document.getElementById('type').value = unescape(value);
  }
  if (argname == "keyword") {
    document.getElementById('keyword').value = unescape(value);
  }
  if (argname == "name") {
    document.getElementById('name').value = unescape(value);
  }
  if (argname == "submit") {
    route();
  }
}

}

function route() {
// Clear any previous route boxes from the map
clearBoxes();

// Convert the distance to box around the route from miles to km
distance = parseFloat(document.getElementById("distance").value) * 1.609344;

var request = {
  origin: document.getElementById("from").value,
  destination: document.getElementById("to").value,
  travelMode: google.maps.DirectionsTravelMode.DRIVING
}

// Make the directions request
directionService.route(request, function(result, status) {
  if (status == google.maps.DirectionsStatus.OK) {
    directionsRenderer.setDirections(result);

    // Box around the overview path of the first route
    var path = result.routes[0].overview_path;
    boxes = routeBoxer.box(path, distance);
    // alert(boxes.length);
    //drawBoxes();
    findPlaces(0);
  } else {
    alert("Directions query failed: " + status);
  }
});
}

// Draw the array of boxes as polylines on the map
function drawBoxes() {
boxpolys = new Array(boxes.length);
for (var i = 0; i < boxes.length; i++) {
  boxpolys[i] = new google.maps.Rectangle({
    bounds: boxes[i],
    fillOpacity: 0,
    strokeOpacity: 1.0,
    strokeColor: '#000000',
    strokeWeight: 1,
    map: map
  });
}
}


function findPlaces(searchIndex) {
var type = document.getElementById('type').value;
var keyword = document.getElementById('keyword').value;
var name = document.getElementById('name').value;
var request = {
  bounds: boxes[searchIndex],
};
if (!!type && (type != "")) {
  if (type.indexOf(',') > 0)
    request.types = type.split(',');
  else
    request.types = [type];
}
// if (!!keyword && (keyword != "")) request.keyword = keyword;
// if (!!name && (name != "")) request.name = name;
service.radarSearch(request, function(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    document.getElementById('side_bar').innerHTML += "bounds[" + searchIndex + "] returns " + results.length + " results<br>"
    for (var i = 0, result; result = results[i]; i++) {
      var marker = createMarker(result);
    }
  } else {
    document.getElementById('side_bar').innerHTML += "bounds[" + searchIndex + "] returns 0 results<br>&nbsp;status=" + status + "<br>";
  }
  if (status != google.maps.places.PlacesServiceStatus.OVER_QUERY_LIMIT) {
    searchIndex++;
    if (searchIndex < boxes.length)
      findPlaces(searchIndex);
  } else { // delay 1 second and try again
    setTimeout("findPlaces(" + searchIndex + ")", 1000);
  }

});
}

// Clear boxes currently on the map
function clearBoxes() {
if (boxpolys != null) {
  for (var i = 0; i < boxpolys.length; i++) {
    boxpolys[i].setMap(null);
  }
}
boxpolys = null;
}

function createMarker(place) {
var placeLoc = place.geometry.location;
if (place.image) {
  var image = new google.maps.MarkerImage(
    place.image, new google.maps.Size(71, 71),
    new google.maps.Point(0, 0), new google.maps.Point(17, 34),
    new google.maps.Size(25, 25));
} else var image = {
  url: "https://maps.gstatic.com/intl/en_us/mapfiles/markers2/measle.png",
  size: new google.maps.Size(7, 7),
  anchor: new google.maps.Point(3.5, 3.5)
};

var marker = new google.maps.Marker({
  map: map,
  icon: image,
  position: place.geometry.location
});
var request = {
  reference: place.reference
};
google.maps.event.addListener(marker, 'click', function() {
  service.getDetails(request, function(place, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
      var contentStr = '<h5>' + place.name + '</h5><p>' + place.formatted_address;
      if (!!place.formatted_phone_number) contentStr += '<br>' + place.formatted_phone_number;
      var photos= place.photos;
      if (!!place.photos) contentStr += '<br>' + photos[0].getUrl({'maxWidth': 35, 'maxHeight': 35});
      if (!!place.website) contentStr += '<br><a target="_blank" href="' + place.website + '">' + place.website + '</a>';
      contentStr += '<br>' + place.types + '</p>';
      infowindow.setContent(contentStr);
      infowindow.open(map, marker);
    } else {
      var contentStr = "<h5>No Result, status=" + status + "</h5>";
      infowindow.setContent(contentStr);
      infowindow.open(map, marker);
    }
  });

});
gmarkers.push(marker);
if (!place.name) place.name =place.formatted_address+" "+ gmarkers.length;
var side_bar_html = "<a href='javascript:google.maps.event.trigger(gmarkers[" + parseInt(gmarkers.length - 1) + "],\"click\");'>" + place.name + "</a><br>";
document.getElementById('side_bar').innerHTML += side_bar_html;
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
